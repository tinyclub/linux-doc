原文:Documentation/kbuild/kbuild.txt

翻译:@huddy1985

校订:

#Output files#

modules.order
--------------------------------------------------
这个文件记录了在 Makefile 中 modules 出现的顺序。modprobe 使用该选项来解决在加载多个模块具有相同的别名问题。

modules.buildin
--------------------------------------------------
这个文件列出了所有被编译到内核的模块。当加载内建模块的时候被modprobe用来避免失败。


#Environment variables#

KCPPFLAGS
--------------------------------------------------
预编译的时候用来传递额外选项。这些预编译的选项被所有的 kbuild 预编译使用，包括 C 文件和汇编文件。

KAFLAGS
--------------------------------------------------
该标志为汇编传递额外选项（对内建函数或变量和模块都适用）。

AFLAGS_MODULE
--------------------------------------------------
在 $(AS) 中使用的特定模块中使用的特定选项。

AFLAGS_KERNEL
--------------------------------------------------
当汇编代码使用 $(AS) 来编译时候，并且该汇编作为内建的函数或者变量时候，该标志用来传递额外选项。

KCFLAGS
--------------------------------------------------
该标志表示为 C 编译器传递额外的选项（包括内建函数变量和模块）。

CFLAGS_KERNEL
--------------------------------------------------
当编译为内建函数或者变量的时候，该标志用来传递额外的选项给 $(CC)。

CFLAGS_MODULE
--------------------------------------------------
该标志被 $(CC) 用来传递额外模块的特定选项。

LDFLAGS_MODULE
--------------------------------------------------
当链接模块的时候，该标志用来传递额外的选项给 $(LD) 。

LDFLAGS_vmlinux
--------------------------------------------------
为最终链接的 vmlinux 传递额外的选项。

KBUILD_VERBOSE
--------------------------------------------------
设置 kbuild verbosity 。该选项可以通过指定与 “V=...” 相同的值。查看 make help 来查看整个列表。设置 “V=...” 的方法要早于使用 KBUILD_VERSION。

KBUILD_EXTMOD
--------------------------------------------------
当编译外部模块的时候，用来设置寻找内核源代码的目录。
指定目录的方法主要有以下几种：

	1） 通过在命令行中使用 “M=...”来设置

	2） 使用环境变量KBUILD_EXTMOD；

	3） 使用环境变量SUBDIRS；

使用上列选项依据他们的优先级来选择。
使用 “M=...” 会覆盖其他选项。

KBUILD_OUTPUT
--------------------------------------------------
指定内核编译时的输出目录。指定方法是使用 “O=...” 。在使用 KBUILD_OUTPUT 变量之前必须先设置 “O=...” 。

KBUILD_DEBARCH
--------------------------------------------------
对于 deb-pkg 的目标，允许覆盖被 deb-pkg 正常部署的启发性配置。
正常情况下， deb-pkg 试图根据 UTS\_MACHINE 来猜测正确的体系结构，
或者根据内核编译时候提供的 .config 文件来指定正确的架构。 
KBUILD\_DEBARCH的值被设置为一个合法的Debian体系结构，通常是假定的值，但是不会去验证这个值。

ARCH
--------------------------------------------------
该变量用来指定编译的体系结构。大多数情况下这个体系结构的名称与 arch/ 下的目录名是一致的。
但是有些体系结构，例如 x86 和 sparc 都有别名。

x86： i386 指定32位体系结构。x86_64 指定 64 的 x86 体系结构

sparc： sparc 对应32位的体系结构， sparc64 指的是64位。

CROSS_COMPILE
--------------------------------------------------
指定可选的 binutils 工具集名称的固定部分。
可以是文件名的一部分也可以是全路径。
也可以在一些安装中被用来 ccache 。

CF
--------------------------------------------------
sparse 的附加项。
CF 通常在命令行下使用：

	make CF=Wbitwise C=2

INSTALL_PATH
--------------------------------------------------
指定存放更新的内核和系统映像的路径。
默认情况下，是放在 /boot 目录中，但是你也可以设定其他地址。

INSTALLKERNEL
--------------------------------------------------
该选项是当键入 “make install” 的时候调用的脚本。默认名称为“installkernel”。
使用以下的参数调用该脚本：

	$1 - 内核版本

	$2 - 内核镜像文件

	$3 - 内核映射文件

	$4 - 默认安装路径 （如果为空，就是root目录）

“make install”的执行特定于架构，所以可能与上边不一致。
INSTALLKERNEL 提供了一种选择，当交叉编译内核的时候，指定用户定制的安装程序。

MODLIB
--------------------------------------------------
指定安装模块的存储位置。默认是：

	$(INSTALL_MOD_PATH)/lib/modules/$(KERNELRELEASE)

默认值如果被忽略的话，那么该值就会被覆盖。

INSTALL_MOD_PATH
--------------------------------------------------
INSTALL\_MOD\_PATH 指定了M ODLIB 存储位置的前缀。该值在 makefile 中并没有被定义，但是如果需要的话，
该参数可以被传递给 make 命令。

INSTALL_MOD_STRIP
--------------------------------------------------
INSTALL\_MOD\_STRIP 如果被定义，这些模块被安装后会移除不需要的信息（如 debug 信息）。
如果 INSTALL\_MOD\_STRIP = ‘1’， 默认的选项 --strip-debug 将被使用。否则的话，INSTALL\_MOD\_STRIP 将作为 strip 命令
的选项。

INSTALL_FW_PATH
--------------------------------------------------
INSTALL_FW_PATH 指定在何处安装固件。
默认地址是：

	$(INSTALL_MOD_PATH)/lib/firmware

默认值如果被忽略的话，那么该值就会被覆盖。

INSTALL_HDR_PATH
--------------------------------------------------
INSTALL\_HDR\_PATH 指定安装用户空间头文件的存储位置。
默认是：
	
	$(objtree)/usr

$(objtree) 是保存输出文件的目录。输出文件通常通过命令中执行 “O=...” 来设置。
默认值如果被忽略的话，那么该值就会被覆盖。

KBUILD_MODPOST_WARN
--------------------------------------------------
KBUILD\_MODPOST\_WARN 如果被设置，那么可以避免在最后模块链接阶段出现未定义符号的错误。
它能把这种错误改变为警告。

KBUILD_MODPOST_NOFINAL
--------------------------------------------------
KBUILD\_MODPOST\_NOFINAL 如果被设置的话，可以用来跳过最后的模块链接。这样做的主要作用是加快测试时的编译速度。

KBUILD_EXTRA_SYMBOLS
--------------------------------------------------
针对调用别的模块符号的模块。
详情请看 modules.txt

ALLSOURCE_ARCHS
--------------------------------------------------
针对 tags/TAGS/cscope 目录下的目标，你可以从数据库中指定至少一种架构，多种之间通过 “ ” 来分开。
例如：


	$ make ALLSOURCE_ARCHS="x86 mips arm" tags

为了得到所有可用架构，你可以指定所有架构。
例如：

	$ make ALLSOURCE_ARCHS=all tags

KBUILD_ENABLE_EXTRA_GCC_CHECKS
--------------------------------------------------
如果在编译命令行中输入 “W=1” ，这个环境变量能使gcc打开附加的选项 “gcc -W ...”，以作更多的扩展编译时检查。

KBUILD_BUILD_TIMESTAMP
--------------------------------------------------
通过给 KBUILD\_BUILD\_TIMESTAMP 环境变量设置一个时间字符串（代表系统版本）覆盖掉通过 UTS_VERSION 定义的版本
（通过 uname -v显示的系统版本）。这个值可以通过 date -d <string\> 来传递。默认值是在编译的那一刻， date 命令的输出

KBUILD_BUILD_USER, KBUILD\_BUILD\_HOST
--------------------------------------------------
这两个参数允许覆盖在 boot 阶段和 /proc/version 显示的 user@host 字符串。默认分别是 whoami 和 host的输出。

KBUILD_LDS
--------------------------------------------------
链接脚本的全路径名。该值通过顶层的 Makefile 传递进来。

KBUILD_VMLINUX_INIT
--------------------------------------------------
所有针对 vmlinux 的 init 部分的文件。被 KBUILD\_VMLINUX\_INIT 指定的文件会被优先链接。

KBUILD_VMLINUX_MAIN
--------------------------------------------------
所有针对 vmlinux 的 main 部分的文件。 KBUILD\_VMLINUX\_INIT 和 KBUILD\_VMLINUX\_MAIN 一起用来指定所有被链接到 mlinux 的文件。
